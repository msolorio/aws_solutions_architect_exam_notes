# DNS, Caching, and Performance Optization

## Route 53
- route 53 is a DNS server
- hosted zone represents a set of records belonging to a domain

Steps to connect
- client types domain in browser
- request makes its way to Route 53
- Route 53 returns IP for domain
- client makes request for IP

---

#### Domain Registration

#### Hosted Zone
Sets up a hosted zone for domain

#### Health Checks
Can configure health checks with Route 53 to be run on EC2 instances

#### Traffic Flow
Gives fine control on how to send traffic to various IP addresses

---

## Exercise - Register Domain with Route 53

[Already did this]

---

## Route 53 Hosted Zones

A file with a set of records

#### Records
indicates how a domain can be resolved

A record can have a Time to Live (TTL) set
- how long the browser will cache the response IP from the DNS for that domain before reaching out to DNS again
- if TTL is too long and something changes
  - clients could try to connect to old IP

---

## Private Hosted Zone

Can create a private hosted zone associated with a VPC

Can use any domain names you want because they are private to VPC

hosted zone has a records table that routes to private IP address

On VPC must enable
- Hostnames
- DNS Resolution

---

## Migrating Hosted Zones

You can
- migrate hosted zones from another DNS provider
- migrate your hosted zones to another registrar / DNS provider
- migrate your hosted zone to another AWS account

- associate a hosted zone with a VPC in another account
  - Steps
    - 1). Authorize assiation with VPC in second account
    - 2). Create an association in the second account

---

---

## Routing Policies (with Route 53)

---

## Simple
provides the IP address associated with a domain name



---

## Failover
[Common Exam Question]
- Initially directs all traffic to primary IP
- if primary IP becomes unhealthy
  - then directs traffic to next IP in the list
- Combined with health checks

---

## Geolocation
uses client's geographic location to send IP for closest region

- Checks what global geolocation zone a client maps to
  - if a record exists for that zone
    - direct client to associated IP
  - otherwise send to default IP 


---

## Goeproximity
Directs client to the closest region within a geographic area

---

## Latency
[Common Exam Question]
- Directs client based on lowest latency route to a resource
- Can be combined with Health checks

---

## Multivalue Answer
- cycles through several IP addresses
- can be combined with health checks so Route 53 only returns healthy records
- can function as a basic load balancer

#### Weighted
Routes based on relative weights assigned to resources

- Can create multiple records with same domain pointing to different IPs
- each IP given a different weight
- Can be used for A/B testing

- Can be combined with Health checks
---

## Exercise - Using Route 53 Routing Policies

Launch 2 EC2 instances
- in different regions far from each other
- add user data
  - displays webpage showing AZ
- store public IPs for each instance for later use

Create A record for each instance
- value is IP address
- routing policy - Latency
- choose region
- give a human readable Record ID

Test clients from different location
- Use VPN to change location
- See which instance you get returned
- should get instance closest to client

Clean up
- delete A records 
- terminate instances

---

## Route 53 Resolver

#### DNS Resolver
Allows a DNS server to forward DNS request downstream to other DNS servers to resolve IP for a domain

Allows for connecting an on-premise DNS server to Route 53
- either for
  - resolving requests from EC2 instances to on-premise DNSs
  - resolving requests from client to Route 53 via an on-premise data center

#### DNS Resolver - Outbound Endpoint
- On-premise data center and VPC are connected with VPN connection
- An EC2 instance makes a request for a domain name that can only be resolved by an on-premise DNS
- It attempts to resolve domain name with Route 53
- Route 53 directs request to Outbound Endpoint (exists in VPC)
- Outbound Endpoint directs request to on-premise DNS server
- DNS server resolves domain to private IP and sends to EC2 instance

[See slide]

---

#### Inbound Endpoint

- On-premise data center and VPC connected with VPN
- A client in on-premise data center makes request for domain that can only be resolved by Route 53
- Client attempts to resolve with on-premise DNS
- On-premise DNS forwards to inbound endpoint on VPC
- inbound inpoint forwards to Route 53 where domain is resolved

---

## CloudFront Origins and Distribution

### CloudFront
- A CDN
  - Content Delivery Network
- Meant for inceasing performance / reducing latency for accessing files

### Origin
The central source of truth for your content

### Edge Locations
- The distributed global network of servers storing chaches of your content
- content is pushed from the origin and cached in the edge locations
- for sending content to users with lower latency

If client cannot find content at an edge location
- it will look at the origin
- request is forwarded over AWS global network not internet
  - higher performance

---

### Distribution

The entity created in CloudFront for managing CDN

A distrubiton
- has an endpoint
  - for example - `d1msoloriokf92kfk.cloudfront.net`
- an origin
  - holding files
  - can specify many origins

Allows for
- faster delivery of static and dynamic content
- media files
- CRUD on objects
- submitting data via web form
- streaming of real time events

Can configure
- path patterns
  - determine which origin to be sourced from
- Cache policy
  - determine for how long data is cached at edge locations

---

## CloudFront Caching and Behaviors

#### Regional Edge Caches
- Sit between region and Edge locations
- Can cache more content than edge locations
- 12 Regional Edge Caches globally

---

#### Edge Location
- 210 Edge locations
- a point of presence
  - where Users initially connects to distribution

#### How Caching Works
- User first attemps to find content at Edge Location
- All traffic from that point goes over AWS global network
  - low latency
- If not found goes to Regional Edge Cache
- If not found goes to Region
- Region returns content
  - caching content in
    - Regional Edge Cache
    - Edge Location
    - content is cached for 24 hours by default
  - return to user

### TTL (Time to Live)
- defaults to 24 hours
- decreasing TTL
  - better for dynamic content
  - content you expect to change often
- increasing TTL
  - better performance
  - reduces load on origin

- Can set a maximum and a default TTL
- Can define different TTLs for different file types
- After cache expires
  - CloudFront checks origin to see if file is latest version
  - repaces cache with updated version

Can control Cache with header
- Cache-Control - `max-age=<seconds>`
- specifies how long until CloudFront gets object again from origin
- Expires - sets expiration date and time

### CloudFront Path Patterns

Can direct client requests based on path patterns
- for example
  - requests for *.jpg to Origin1
  - requests for *.mp4 to Origin2

### Caching Based on Request Headers

[Come back to this]
[Common exam question]

---


